<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è±¡è©•ä¾¡ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</title>
    <style>
        /* ãƒ™ãƒ¼ã‚¹è¨­å®š */
        body { font-family: "Helvetica Neue", Arial, sans-serif; text-align: center; background-color: #f0f2f5; margin: 0; padding: 0; color: #333; }
        h2 { margin: 15px 0 5px 0; font-size: 1.5rem; }
        p { margin-top: 0; line-height: 1.6; }

        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .screen { display: none; max-width: 800px; margin: 20px auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .active { display: block; }

        /* ç”»åƒãƒªã‚¹ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #rating-list {
            display: flex; flex-direction: column; gap: 40px; margin-top: 30px;
        }

        /* å€‹åˆ¥ã®ç”»åƒã‚«ãƒ¼ãƒ‰ */
        .rating-card {
            background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: left;
        }
        
        /* ç”»åƒéƒ¨åˆ†ï¼ˆå¤§ããè¡¨ç¤ºï¼‰ */
        .card-image { 
            width: 100%; cursor: pointer; text-align: center; background: #fafafa; padding: 10px 0; border-radius: 5px;
        }
        .card-image img { 
            max-width: 100%; height: auto; border-radius: 4px; 
            max-height: 500px; 
            object-fit: contain;
            transition: transform 0.2s;
        }
        .card-image img:hover { transform: scale(1.01); }
        .zoom-hint { font-size: 0.9rem; color: #666; display: block; margin-top: 5px; }

        /* å…¥åŠ›éƒ¨åˆ† */
        .card-inputs { margin-top: 20px; padding: 10px 20px; background: #f8f9fa; border-radius: 8px; }
        
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .slider-group { margin-bottom: 10px; }
        .slider-label { 
            font-weight: bold; font-size: 1.1em; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; 
            color: #d9534f; /* èµ¤è‰² */
        }
        .slider-value { 
            color: #d9534f; font-weight: bold; font-size: 1.4em; width: 60px; text-align: right; 
        }
        
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ¬ä½“ */
        input[type=range] { 
            width: 100%; margin: 10px 0; cursor: pointer; 
            height: 10px; border-radius: 5px; background: #ddd; outline: none; appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #d9534f; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* ç›®ç››ã‚Šã‚¬ã‚¤ãƒ‰ */
        .scale-guide {
            display: flex; justify-content: space-between; font-size: 0.85em; color: #666; font-weight: bold;
        }

        /* IDè¡¨ç¤º */
        .img-id { font-size: 0.8rem; color: #ccc; margin-bottom: 5px; }

        /* ãƒœã‚¿ãƒ³ */
        button.btn-primary {
            background-color: #007bff; color: white; border: none; padding: 15px 50px;
            font-size: 1.2rem; border-radius: 50px; cursor: pointer; margin-top: 30px; margin-bottom: 50px;
            transition: background 0.3s;
        }
        button.btn-primary:hover { background-color: #0056b3; transform: scale(1.02); }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); }
        #modal-content { margin: auto; display: block; max-width: 95%; max-height: 95%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 5px; }
        #modal-close { position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="survey-screen" class="screen active">
        <h2>ç”»åƒã®å°è±¡è©•ä¾¡ï¼ˆçµ¶å¯¾è©•ä¾¡ï¼‰</h2>
        <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left;">
            <strong>è©•ä¾¡åŸºæº–ï¼šä¸æ°—å‘³ã•ãƒ»ææ€–æ„Ÿ</strong><br>
            è¡¨ç¤ºã•ã‚Œã‚‹ç”»åƒã‚’è¦‹ã¦ã€ã©ã‚Œãã‚‰ã„<strong>ã€Œä¸æ°—å‘³ã ã€ã€Œæ€–ã„ã€</strong>ã¨æ„Ÿã˜ã‚‹ã‹ã‚’ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚<br>
            <ul style="margin: 5px 0 0 20px; font-size: 0.95em; color: #555;">
                <li><strong>-50</strong>ï¼š å…¨ãæ€–ããªã„ / ä½•ã‚‚æ„Ÿã˜ãªã„</li>
                <li><strong>0</strong>ï¼š ã©ã¡ã‚‰ã§ã‚‚ãªã„</li>
                <li><strong>+50</strong>ï¼š éå¸¸ã«ä¸æ°—å‘³ / å¼·ã„ææ€–ã‚’æ„Ÿã˜ã‚‹</li>
            </ul>
            <strong>â€»ã§ãã‚‹ã ã‘å¤§ããªç”»é¢ã§è§£ç­”ã—ã¦ãã ã•ã„</strong>
        </div>

        <div id="rating-list"></div>

        <button class="btn-primary" onclick="showDeviceCheck()">å›ç­”ã‚’å®Œäº†ã™ã‚‹</button>
    </div>

    <div id="device-screen" class="screen" style="max-width: 600px;">
        <h2>å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</h2>
        <p>æœ€å¾Œã«ã€ä½¿ç”¨ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚</p>
        <div style="text-align: left; display: inline-block; margin: 20px; font-size: 1.1rem;">
            <div style="margin:10px"><label><input type="radio" name="device" value="PC"> PC (ãƒã‚¦ã‚¹æ“ä½œ)</label></div>
            <div style="margin:10px"><label><input type="radio" name="device" value="Tablet"> ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ</label></div>
            <div style="margin:10px"><label><input type="radio" name="device" value="Smartphone"> ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</label></div>
        </div>
        <br>
        <button id="send-btn" class="btn-primary" onclick="submitAll()">é€ä¿¡ã—ã¦çµ‚äº†</button>
    </div>

    <div id="finish-screen" class="screen" style="max-width: 600px;">
        <h2>é€ä¿¡å®Œäº†</h2>
        <p>ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚<br>ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>
    </div>

    <div id="modal" onclick="closeModal()">
        <span id="modal-close">&times;</span>
        <img id="modal-content">
    </div>

    <script>
        // ==========================================
        // â–¼ è¨­å®šã‚¨ãƒªã‚¢
        // ==========================================
        
        // â˜…ã“ã“ã«GASã®URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzbTUKNskWjikudI7fJqFX2GZfgtjF7OdVcn9kKCsDQTPQS7vK-aNt5sOB9N6rw8vQcug/exec";

        // ç”»åƒãƒ‘ã‚¹
        const imagePath = "kenkyu/3/";

        // é¸å®šã—ãŸ12æšã®ç”»åƒãƒªã‚¹ãƒˆ
        const imageList = [
            "1200.png", "4700.png", "19000.png", "76000.png", "300000.png", "1200000.png"
        ];

        // ==========================================
        // â–² è¨­å®šã“ã“ã¾ã§
        // ==========================================

        const userId = "user_" + Math.random().toString(36).substr(2, 9);
        let imageLabels = {}; // ãƒ©ãƒ³ãƒ€ãƒ IDç”¨

        window.onload = function() {
            // ãƒ©ãƒ³ãƒ€ãƒ IDç”Ÿæˆ
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
            chars.sort(() => Math.random() - 0.5);
            imageLabels = {};
            imageList.forEach((filename, index) => {
                imageLabels[filename] = chars[index];
            });

            const container = document.getElementById("rating-list");
            
            // ç”»åƒã®è¡¨ç¤ºé †ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã™ã‚‹
            const shuffledList = [...imageList].sort(() => Math.random() - 0.5);

            shuffledList.forEach((filename, index) => {
                const label = imageLabels[filename];
                const card = document.createElement("div");
                card.className = "rating-card";
                card.innerHTML = `
                    <div class="img-id">ID: ${label}</div>
                    <div class="card-image" onclick="openModal('${imagePath + filename}')">
                        <img src="${imagePath + filename}" alt="ç”»åƒ">
                        <span class="zoom-hint">ğŸ” ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‹¡å¤§</span>
                    </div>
                    <div class="card-inputs" id="inputs-${index}" data-img="${filename}">
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                ğŸ‘» ä¸æ°—å‘³ãƒ»ææ€–åº¦ <span class="slider-value" id="val-${index}">0</span>
                            </div>
                            <input type="range" min="-50" max="50" value="0" 
                                oninput="document.getElementById('val-${index}').innerText = (this.value > 0 ? '+' : '') + this.value; this.style.background = getGradient(this.value);">
                            <div class="scale-guide">
                                <span>-50 (æ€–ããªã„)</span>
                                <span>0</span>
                                <span>+50 (éå¸¸ã«æ€–ã„)</span>
                            </div>
                        </div>

                    </div>
                `;
                container.appendChild(card);
            });
        };

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è‰²ã‚’å¤‰ãˆã‚‹æ¼”å‡ºï¼ˆ-50ã€œ+50å¯¾å¿œç‰ˆï¼‰
        function getGradient(val) {
            // -50(é’) -> 0(ç°) -> +50(èµ¤)
            // å€¤ã«50ã‚’è¶³ã™ã¨ 0 ï½ 100 ã«ãªã‚‹
            const percent = parseInt(val) + 50; 
            return `linear-gradient(90deg, #d9534f ${percent}%, #ddd ${percent}%)`;
        }

        function showDeviceCheck() {
            document.getElementById("survey-screen").style.display = "none";
            document.getElementById("device-screen").style.display = "block";
            window.scrollTo(0, 0);
        }

        function submitAll() {
            const radios = document.getElementsByName("device");
            let selectedDevice = "";
            for(let radio of radios) {
                if(radio.checked) {
                    selectedDevice = radio.value;
                    break;
                }
            }
            if (selectedDevice === "") {
                alert("ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„");
                return;
            }

            const answers = [];
            const cards = document.getElementsByClassName("card-inputs");
            
            for (let card of cards) {
                const imgName = card.getAttribute("data-img");
                const inputs = card.getElementsByTagName("input"); 
                
                answers.push({
                    img: imgName,
                    u: inputs[0].value, // Uncannyï¼ˆä¸æ°—å‘³ï¼‰ã®å€¤
                    d: 0, // Disgustï¼ˆä¸å¿«ï¼‰ã¯0ã§é€ã‚‹
                    a: 0  // Affinityï¼ˆå¥½æ„Ÿï¼‰ã¯0ã§é€ã‚‹
                });
            }

            const btn = document.getElementById("send-btn");
            btn.disabled = true;
            btn.textContent = "é€ä¿¡ä¸­...";

            fetch(GAS_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "text/plain" },
                body: JSON.stringify({
                    type: "rating", // ã‚·ãƒ¼ãƒˆ3ã«é€ã‚‹ãŸã‚ "rating" ã‚’æŒ‡å®š
                    userId: userId,
                    answers: answers,
                    device: selectedDevice
                })
            }).then(() => {
                document.getElementById("device-screen").style.display = "none";
                document.getElementById("finish-screen").style.display = "block";
            }).catch(() => {
                alert("é€ä¿¡å¤±æ•—");
                btn.disabled = false;
            });
        }

        function openModal(src) {
            const modal = document.getElementById("modal");
            const content = document.getElementById("modal-content");
            content.src = src;
            modal.style.display = "block";
        }
        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }
    </script>
</body>
</html>
